<!DOCTYPE html>
<html>
<head>
    <title>Word Hunt Solver</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body class="solver-page">
    <div class="page-wrapper">
        <header class="page-header">
            <p class="hero-subtitle">Enter any 4×4 board and instantly surface the highest scoring words.</p>
            <h1>Word Hunt Solver</h1>
            <div class="header-actions">
                <a href="/records" class="link-button">View leaderboard →</a>
            </div>
        </header>

        <div class="page-grid">
            <section class="card solver-card">
                <h2>Enter your board</h2>
                <p class="card-subtitle">Fill in all 16 squares left-to-right, top-to-bottom. Letters are auto-capitalized.</p>
                <form method="post" class="solver-form">
                    <input type="hidden" id="input_grid" name="input_grid" required>
                    <label for="board-grid">Letter grid</label>
                    <div id="board-grid">
                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">

                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">

                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">

                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">
                      <input maxlength="1">
                    </div>

                    <button type="submit">Solve board</button>
                </form>
            </section>

            <section class="card results-card">
                <h2>Results</h2>
                {% if submitted %}
                    <div class="stats-grid">
                        <div class="stat-pill">
                            <span class="stat-label">Total score</span>
                            <span class="stat-value">{{ total_score }}</span>
                        </div>
                        <div class="stat-pill">
                            <span class="stat-label">Percentile</span>
                            <span class="stat-value">{{ better_than_me_percentage }}%</span>
                        </div>
                        <div class="stat-pill">
                            <span class="stat-label">Words found</span>
                            <span class="stat-value">{{ results|length }}</span>
                        </div>
                    </div>

                    {% if results %}
                        <ul class="results-list">
                            {% for result in results %}
                            <li class="result-item">
                                <span class="word">{{ result[0]|upper }}</span>
                                <span class="points">{{ result[1] }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="notice">No valid words were detected. Double-check the board input and try again.</p>
                    {% endif %}
                {% else %}
                    <p class="notice">Enter a board on the left to see ranked results here.</p>
                {% endif %}
            </section>
        </div>
    </div>

    <script>
      const GRID_SIZE = 4;
      const grid = document.getElementById("board-grid");
      const cells = Array.from(grid.querySelectorAll("input"));
      const hiddenInput = document.getElementById("input_grid");
      const solverForm = document.querySelector(".solver-form");

      const allCellsFilled = () => cells.every(cell => (cell.value || "").trim().length === 1);

      if (cells.length > 0) {
        cells[0].focus();
      }

      cells.forEach((cell, idx) => {
        cell.addEventListener("input", (e) => {
          const val = e.target.value.toUpperCase();
          e.target.value = val.slice(-1);

          if (e.target.value) {
            if (idx < cells.length - 1) {
              cells[idx + 1].focus();
            }
          }
        });

        cell.addEventListener("keydown", (e) => {
          const row = Math.floor(idx / GRID_SIZE);
          const col = idx % GRID_SIZE;

          if (e.key === "Backspace" && !cell.value && idx > 0) {
            cells[idx - 1].focus();
            e.preventDefault();
          }
          if (e.key === "ArrowRight" && col < GRID_SIZE - 1) {
            cells[idx + 1].focus();
            e.preventDefault();
          }
          if (e.key === "ArrowLeft" && col > 0) {
            cells[idx - 1].focus();
            e.preventDefault();
          }
          if (e.key === "ArrowDown" && row < GRID_SIZE - 1) {
            cells[idx + GRID_SIZE].focus();
            e.preventDefault();
          }
          if (e.key === "ArrowUp" && row > 0) {
            cells[idx - GRID_SIZE].focus();
            e.preventDefault();
          }
          if (e.key === "Enter" && !allCellsFilled()) {
            alert("Fill in all 16 cells before solving.");
            e.preventDefault();
          }
        });
      });

      solverForm.addEventListener("submit", (e) => {
        if (!allCellsFilled()) {
          alert("Fill in all 16 cells before solving.");
          e.preventDefault();
          return;
        }
        const letters = cells.map(c => (c.value || "").toLowerCase());
        hiddenInput.value = letters.join("");
      });
    </script>
</body>
</html>
